<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROTON - User Management</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .glow-on-hover:hover {
            box-shadow: 0 0 30px rgba(56, 189, 248, 0.3);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800 text-white min-h-screen flex flex-col">
    <!-- Authentication utility -->
    <script src="/static/js/auth.js"></script>
    <script>
        // AUTHENTICATION & AUTHORIZATION CHECK
        // This page is restricted to users with 'org_admin' role.
        //
        // Required localStorage keys:
        //   - 'access_token': JWT token containing user claims
        //   - 'user_data': JSON string with user profile data
        //
        // Authorization Flow:
        // 1. Check for access_token in localStorage
        // 2. Parse JWT to extract role claim
        // 3. Verify role is 'org_admin'
        // 4. If unauthorized, redirect to /home
        //
        // This page allows Org Admins to manage users within their organization.
        verifyRole('org_admin', '/home');
    </script>

    <header class="bg-black/20 backdrop-blur-md border-b border-white/10 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3 flex-shrink-0">
                    <img src="/static/logo.png" alt="App Logo" class="h-10 w-auto">
                    <div>
                        <span
                            class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-blue-500">PROTON</span>
                        <p class="text-sm text-slate-400 italic hidden sm:block"> by Simon India Limited</p>
                    </div>
                </div>
                <div id="header-right" class="flex items-center space-x-2 sm:space-x-4">
                    <!-- User info and logout button will be injected here by script -->
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto mt-12 px-4 sm:px-6 lg:px-8 pb-20">
        <div class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-white mb-3">User Management</h1>
            <p class="text-lg text-slate-300">Manage organization users, create employee accounts, and control access permissions.</p>
        </div>

        <div id="root"></div>
    </main>

    <footer class="py-12 bg-black/40 border-t border-white/10 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                </div>
                <div class="text-center md:text-right">
                    <p class="text-slate-400 text-sm mb-2">
                        Developed by Simon India Limited
                    </p>
                    <p class="text-slate-500 text-xs">
                        Â© 2025 Simon India Limited. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Use new format only - user_data is guaranteed to exist due to initial check
            const userDataString = localStorage.getItem('user_data');
            
            let authData = null;
            let email = '';
            
            if (userDataString) {
                try {
                    authData = JSON.parse(userDataString);
                    email = authData.email || '';
                } catch (e) {
                    console.error('Error parsing user_data:', e);
                }
            }
            
            if (email) {
                const headerRight = document.getElementById('header-right');
                headerRight.innerHTML = `
                    <span class="text-sm font-medium text-slate-300 hidden sm:inline">${email}</span>
                    <button onclick="handleLogout()" class="px-3 sm:px-4 py-2 text-sm font-medium text-white bg-red-600/50 hover:bg-red-600/80 border border-red-500/50 rounded-lg transition-colors">Logout</button>
                `;
            }
        });

        function handleLogout() {
            localStorage.removeItem('aiProjectControlTowerAuth_v2');
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user_data');
            window.location.href = '/';
        }
    </script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Session Timeout Handler Functions
        // Check if JWT token is expired
        function isTokenExpired(token) {
            if (!token) return true;
            try {
                let payload = token.split('.')[1];
                payload = payload.replace(/-/g, '+').replace(/_/g, '/');
                while (payload.length % 4) {
                    payload += '=';
                }
                const decoded = JSON.parse(atob(payload));
                if (decoded.exp) {
                    const expDate = new Date(decoded.exp * 1000);
                    return expDate < new Date();
                }
                return false;
            } catch {
                return true;
            }
        }

        // Show session timeout message and redirect
        function handleSessionTimeout() {
            // Clear all auth data
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user_data');
            localStorage.removeItem('aiProjectControlTowerAuth_v2');
            sessionStorage.removeItem('trial_banner_dismissed');
            sessionStorage.removeItem('trial_banner_dismissed_at');
            
            // Show timeout message
            const root = document.getElementById('root');
            if (root) {
                root.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100">
                        <div class="text-center p-8 bg-white rounded-2xl shadow-xl border border-slate-200 max-w-md">
                            <div class="mb-6">
                                <div class="mx-auto w-16 h-16 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center mb-4">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <h2 class="text-2xl font-bold text-slate-800 mb-2">Session Timed Out</h2>
                                <p class="text-slate-600 mb-4">Your session has expired for security reasons.</p>
                                <p class="text-sm text-slate-500 mb-6">Redirecting to login...</p>
                                <div class="flex justify-center">
                                    <div class="animate-spin h-8 w-8 border-4 border-slate-200 border-t-indigo-600 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Redirect after 2 seconds
            setTimeout(() => {
                window.location.href = '/';
            }, 2000);
        }

        // Retrieves the current JWT access token from localStorage.
        // Returns: token string or null if not found
        function getAuthToken() {
            return localStorage.getItem('access_token');
        }

        // JWT TOKEN REFRESH UTILITY
        // Attempts to refresh an expired access token using the refresh token.
        // Returns: true on success, false on failure
        // Side effects: Updates 'access_token' in localStorage on success
        async function refreshAccessToken() {
            const refreshToken = localStorage.getItem('refresh_token');
            if (!refreshToken) {
                handleSessionTimeout();
                return false;
            }
            
            try {
                const response = await fetch('/api/refresh', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ refresh_token: refreshToken })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.access_token) {
                        localStorage.setItem('access_token', data.access_token);
                        return true;
                    }
                }
                // Refresh failed - show session timeout
                handleSessionTimeout();
                return false;
            } catch (error) {
                // Refresh failed - show session timeout
                handleSessionTimeout();
                return false;
            }
        }

        // Makes authenticated HTTP requests with automatic token refresh.
        // Handles 401 errors by attempting token refresh and retrying once.
        // On persistent auth failure, shows session timeout message.
        async function authenticatedFetch(url, options = {}) {
            let token = getAuthToken();
            if (!token) {
                handleSessionTimeout();
                throw new Error('Session expired');
            }

            // Check if token is expired before making request
            if (isTokenExpired(token)) {
                const newToken = await refreshAccessToken();
                if (!newToken || isTokenExpired(newToken)) {
                    throw new Error('Session expired');
                }
                token = getAuthToken();
            }

            const headers = {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                ...options.headers
            };

            let response = await fetch(url, {
                ...options,
                headers
            });

            // If 401, try to refresh token and retry once
            if (response.status === 401) {
                const refreshSuccess = await refreshAccessToken();
                if (refreshSuccess) {
                    const newToken = getAuthToken();
                    if (newToken && !isTokenExpired(newToken)) {
                        headers['Authorization'] = `Bearer ${newToken}`;
                        response = await fetch(url, {
                            ...options,
                            headers
                        });
                    } else {
                        throw new Error('Session expired');
                    }
                } else {
                    throw new Error('Session expired');
                }
            }

            return response;
        }

        // Format date utility
        function formatDate(dateString) {
            if (!dateString) return 'â€”';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        // Get role badge color
        function getRoleBadgeColor(role) {
            if (role === 'org_admin') return 'bg-blue-500/20 text-blue-300 border-blue-400/30';
            if (role === 'org_user') return 'bg-green-500/20 text-green-300 border-green-400/30';
            if (role === 'super_admin') return 'bg-purple-500/20 text-purple-300 border-purple-400/30';
            return 'bg-slate-500/20 text-slate-300 border-slate-400/30';
        }

        // Get status badge color
        function getStatusBadgeColor(status) {
            if (status === 'approved') return 'bg-green-500/20 text-green-300 border-green-400/30';
            if (status === 'pending') return 'bg-yellow-500/20 text-yellow-300 border-yellow-400/30';
            if (status === 'suspended') return 'bg-red-500/20 text-red-300 border-red-400/30';
            return 'bg-slate-500/20 text-slate-300 border-slate-400/30';
        }

        // Loading Spinner Component
        const LoadingSpinner = ({ message }) => React.createElement('div', { className: 'flex items-center justify-center py-12' },
            React.createElement('div', { className: 'text-center' },
                React.createElement('div', { className: 'animate-spin h-10 w-10 border-4 border-sky-300 border-t-transparent rounded-full mx-auto mb-4' }),
                React.createElement('p', { className: 'text-slate-300' }, message || 'Loading...')
            )
        );

        // Toast Notification Component
        const NotificationToast = ({ message, type = 'success', onDismiss }) => {
            useEffect(() => {
                const timer = setTimeout(() => {
                    if (onDismiss) onDismiss();
                }, 3000);
                return () => clearTimeout(timer);
            }, [onDismiss]);

            const colorMap = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600'
            };
            const color = colorMap[type] || colorMap.success;

            return React.createElement('div', {
                className: `fixed top-20 right-4 ${color} text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center justify-between min-w-[300px]`,
                onClick: onDismiss
            },
                React.createElement('span', null, message),
                React.createElement('button', {
                    onClick: onDismiss,
                    className: 'ml-4 text-white hover:text-gray-200'
                }, 'Ã—')
            );
        };

        // Modal Component
        const Modal = ({ title, onClose, children, footer }) => React.createElement('div', {
            className: 'fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4',
            onClick: (e) => {
                if (e.target === e.currentTarget) onClose();
            }
        },
            React.createElement('div', {
                className: 'glass-card rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-auto'
            },
                React.createElement('div', {
                    className: 'p-6 border-b border-white/10 flex items-center justify-between'
                },
                    React.createElement('h3', { className: 'text-2xl font-bold text-white' }, title || ''),
                    React.createElement('button', {
                        onClick: onClose,
                        className: 'text-slate-400 hover:text-white text-2xl'
                    }, 'Ã—')
                ),
                React.createElement('div', { className: 'p-6' }, children),
                footer && React.createElement('div', {
                    className: 'p-6 border-t border-white/10 flex justify-end gap-3'
                }, footer)
            )
        );

        // User Management Table Component
        const UserManagementTable = () => {
            const [users, setUsers] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState('');
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [showEditModal, setShowEditModal] = useState(false);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [selectedUser, setSelectedUser] = useState(null);
            const [notification, setNotification] = useState(null);

            const fetchUsers = useCallback(async () => {
                setIsLoading(true);
                setError('');
                try {
                    const response = await authenticatedFetch('/api/org/users');
                    if (!response) return;
                    if (response.status === 401) return;
                    if (!response.ok) {
                        throw new Error('Failed to fetch users');
                    }
                    const data = await response.json();
                    if (data.status === 'success') {
                        setUsers(data.users || []);
                    } else {
                        setError(data.message || 'Failed to fetch users');
                    }
                } catch (e) {
                    setError(e.message || 'Failed to fetch users');
                } finally {
                    setIsLoading(false);
                }
            }, []);

            useEffect(() => {
                fetchUsers();
            }, [fetchUsers]);

            const handleCreateUser = async (formData) => {
                try {
                    const response = await authenticatedFetch('/api/org/users', {
                        method: 'POST',
                        body: JSON.stringify({
                            email: formData.email,
                            password: formData.password,
                            role: formData.role,
                            status: 'approved'
                        })
                    });
                    if (!response) return;
                    if (response.status === 401) return;
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to create user');
                    }
                    const data = await response.json();
                    if (data.status === 'success') {
                        setNotification({ message: 'User created successfully', type: 'success' });
                        setShowCreateModal(false);
                        fetchUsers();
                    } else {
                        throw new Error(data.message || 'Failed to create user');
                    }
                } catch (e) {
                    setNotification({ message: e.message || 'Failed to create user', type: 'error' });
                }
            };

            const handleUpdateUser = async (userId, formData) => {
                try {
                    const payload = {};
                    if (formData.email) payload.email = formData.email;
                    if (formData.password) payload.password = formData.password;
                    if (formData.status) payload.status = formData.status;

                    const response = await authenticatedFetch(`/api/org/users/${userId}`, {
                        method: 'PUT',
                        body: JSON.stringify(payload)
                    });
                    if (!response) return;
                    if (response.status === 401) return;
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to update user');
                    }
                    const data = await response.json();
                    if (data.status === 'success') {
                        setNotification({ message: 'User updated successfully', type: 'success' });
                        setShowEditModal(false);
                        setSelectedUser(null);
                        fetchUsers();
                    } else {
                        throw new Error(data.message || 'Failed to update user');
                    }
                } catch (e) {
                    setNotification({ message: e.message || 'Failed to update user', type: 'error' });
                }
            };

            const handleDeleteUser = async (userId) => {
                try {
                    const response = await authenticatedFetch(`/api/org/users/${userId}`, {
                        method: 'DELETE'
                    });
                    if (!response) return;
                    if (response.status === 401) return;
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to delete user');
                    }
                    const data = await response.json();
                    if (data.status === 'success') {
                        setNotification({ message: 'User deleted successfully', type: 'success' });
                        setShowDeleteModal(false);
                        setSelectedUser(null);
                        fetchUsers();
                    } else {
                        throw new Error(data.message || 'Failed to delete user');
                    }
                } catch (e) {
                    setNotification({ message: e.message || 'Failed to delete user', type: 'error' });
                }
            };

            return React.createElement('div', { className: 'space-y-6' },
                notification && React.createElement(NotificationToast, {
                    message: notification.message,
                    type: notification.type,
                    onDismiss: () => setNotification(null)
                }),
                React.createElement('div', {
                    className: 'flex justify-end mb-4'
                },
                    React.createElement('button', {
                        onClick: () => setShowCreateModal(true),
                        className: 'px-6 py-3 bg-sky-600 hover:bg-sky-700 text-white rounded-lg font-semibold transition-colors'
                    }, 'Create New User')
                ),
                isLoading ? React.createElement(LoadingSpinner, { message: 'Loading users...' }) :
                error ? React.createElement('div', {
                    className: 'glass-card rounded-xl p-6 text-red-300'
                }, error) :
                React.createElement('div', {
                    className: 'glass-card rounded-xl overflow-hidden'
                },
                    React.createElement('div', {
                        className: 'overflow-x-auto'
                    },
                        React.createElement('table', {
                            className: 'min-w-full divide-y divide-white/10'
                        },
                            React.createElement('thead', {
                                className: 'bg-white/5'
                            },
                                React.createElement('tr', null,
                                    ['Email', 'Role', 'Status', 'Created At', 'Actions'].map(header =>
                                        React.createElement('th', {
                                            key: header,
                                            className: 'px-6 py-3 text-left text-xs font-semibold text-slate-300 uppercase tracking-wider'
                                        }, header)
                                    )
                                )
                            ),
                            React.createElement('tbody', {
                                className: 'divide-y divide-white/10'
                            },
                                users.length === 0 ?
                                    React.createElement('tr', null,
                                        React.createElement('td', {
                                            colSpan: 5,
                                            className: 'px-6 py-12 text-center text-slate-400'
                                        }, 'No users found')
                                    ) :
                                    users.map(user =>
                                        React.createElement('tr', {
                                            key: user.id,
                                            className: 'hover:bg-white/5'
                                        },
                                            React.createElement('td', {
                                                className: 'px-6 py-4 whitespace-nowrap text-sm text-white'
                                            }, user.email),
                                            React.createElement('td', {
                                                className: 'px-6 py-4 whitespace-nowrap'
                                            },
                                                React.createElement('span', {
                                                    className: `px-3 py-1 text-xs font-semibold rounded-full border ${getRoleBadgeColor(user.role)}`
                                                }, user.role)
                                            ),
                                            React.createElement('td', {
                                                className: 'px-6 py-4 whitespace-nowrap'
                                            },
                                                React.createElement('span', {
                                                    className: `px-3 py-1 text-xs font-semibold rounded-full border ${getStatusBadgeColor(user.status)}`
                                                }, user.status)
                                            ),
                                            React.createElement('td', {
                                                className: 'px-6 py-4 whitespace-nowrap text-sm text-slate-300'
                                            }, formatDate(user.created_at)),
                                            React.createElement('td', {
                                                className: 'px-6 py-4 whitespace-nowrap text-sm'
                                            },
                                                React.createElement('div', {
                                                    className: 'flex gap-2'
                                                },
                                                    React.createElement('button', {
                                                        onClick: () => {
                                                            setSelectedUser(user);
                                                            setShowEditModal(true);
                                                        },
                                                        className: 'px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-xs font-medium transition-colors'
                                                    }, 'Edit'),
                                                    React.createElement('button', {
                                                        onClick: () => {
                                                            setSelectedUser(user);
                                                            setShowDeleteModal(true);
                                                        },
                                                        className: 'px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-xs font-medium transition-colors'
                                                    }, 'Delete')
                                                )
                                            )
                                        )
                                    )
                            )
                        )
                    )
                ),
                showCreateModal && React.createElement(CreateUserModal, {
                    onClose: () => setShowCreateModal(false),
                    onSubmit: handleCreateUser
                }),
                showEditModal && selectedUser && React.createElement(EditUserModal, {
                    user: selectedUser,
                    onClose: () => {
                        setShowEditModal(false);
                        setSelectedUser(null);
                    },
                    onSubmit: handleUpdateUser
                }),
                showDeleteModal && selectedUser && React.createElement(DeleteConfirmationModal, {
                    user: selectedUser,
                    onClose: () => {
                        setShowDeleteModal(false);
                        setSelectedUser(null);
                    },
                    onConfirm: handleDeleteUser
                })
            );
        };

        // Create User Modal Component
        const CreateUserModal = ({ onClose, onSubmit }) => {
            const [formData, setFormData] = useState({
                email: '',
                password: '',
                role: 'org_user'
            });
            const [errors, setErrors] = useState({});
            const [showPassword, setShowPassword] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const validateEmail = (email) => {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            };

            const validatePassword = (password) => {
                if (password.length < 8) return { valid: false, message: 'Password must be at least 8 characters' };
                if (!/[A-Z]/.test(password)) return { valid: false, message: 'Password must contain an uppercase letter' };
                if (!/[a-z]/.test(password)) return { valid: false, message: 'Password must contain a lowercase letter' };
                if (!/[0-9]/.test(password)) return { valid: false, message: 'Password must contain a number' };
                if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) return { valid: false, message: 'Password must contain a special character' };
                return { valid: true };
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const newErrors = {};

                if (!formData.email) {
                    newErrors.email = 'Email is required';
                } else if (!validateEmail(formData.email)) {
                    newErrors.email = 'Invalid email format';
                }

                if (!formData.password) {
                    newErrors.password = 'Password is required';
                } else {
                    const passwordValidation = validatePassword(formData.password);
                    if (!passwordValidation.valid) {
                        newErrors.password = passwordValidation.message;
                    }
                }

                if (!formData.role) {
                    newErrors.role = 'Role is required';
                }

                if (Object.keys(newErrors).length > 0) {
                    setErrors(newErrors);
                    return;
                }

                setIsSubmitting(true);
                try {
                    await onSubmit(formData);
                } finally {
                    setIsSubmitting(false);
                }
            };

            return React.createElement(Modal, {
                title: 'Create New User',
                onClose: onClose,
                footer: [
                    React.createElement('button', {
                        key: 'cancel',
                        onClick: onClose,
                        className: 'px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition-colors',
                        disabled: isSubmitting
                    }, 'Cancel'),
                    React.createElement('button', {
                        key: 'submit',
                        onClick: handleSubmit,
                        className: 'px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition-colors',
                        disabled: isSubmitting
                    }, isSubmitting ? 'Creating...' : 'Create User')
                ]
            },
                React.createElement('form', {
                    onSubmit: handleSubmit,
                    className: 'space-y-4'
                },
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block text-sm font-medium text-slate-300 mb-2'
                        }, 'Email *'),
                        React.createElement('input', {
                            type: 'email',
                            value: formData.email,
                            onChange: (e) => {
                                setFormData({ ...formData, email: e.target.value });
                                setErrors({ ...errors, email: '' });
                            },
                            className: `w-full px-4 py-2 bg-white/10 border ${errors.email ? 'border-red-500' : 'border-white/20'} rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500`,
                            placeholder: 'user@example.com',
                            required: true
                        }),
                        errors.email && React.createElement('p', {
                            className: 'text-red-400 text-sm mt-1'
                        }, errors.email)
                    ),
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block text-sm font-medium text-slate-300 mb-2'
                        }, 'Password *'),
                        React.createElement('div', {
                            className: 'relative'
                        },
                            React.createElement('input', {
                                type: showPassword ? 'text' : 'password',
                                value: formData.password,
                                onChange: (e) => {
                                    setFormData({ ...formData, password: e.target.value });
                                    setErrors({ ...errors, password: '' });
                                },
                                className: `w-full px-4 py-2 bg-white/10 border ${errors.password ? 'border-red-500' : 'border-white/20'} rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500`,
                                placeholder: 'Enter password',
                                required: true
                            }),
                            React.createElement('button', {
                                type: 'button',
                                onClick: () => setShowPassword(!showPassword),
                                className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-white'
                            }, showPassword ? 'ðŸ‘ï¸' : 'ðŸ‘ï¸â€ðŸ—¨ï¸')
                        ),
                        errors.password && React.createElement('p', {
                            className: 'text-red-400 text-sm mt-1'
                        }, errors.password),
                        React.createElement('p', {
                            className: 'text-slate-400 text-xs mt-1'
                        }, 'Must be at least 8 characters with uppercase, lowercase, number, and special character')
                    ),
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block text-sm font-medium text-slate-300 mb-2'
                        }, 'Role *'),
                        React.createElement('select', {
                            value: formData.role,
                            onChange: (e) => {
                                setFormData({ ...formData, role: e.target.value });
                                setErrors({ ...errors, role: '' });
                            },
                            className: `w-full px-4 py-2 bg-white/10 border ${errors.role ? 'border-red-500' : 'border-white/20'} rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-sky-500`
                        },
                            React.createElement('option', { value: 'org_user' }, 'org_user'),
                            React.createElement('option', { value: 'org_admin' }, 'org_admin')
                        ),
                        errors.role && React.createElement('p', {
                            className: 'text-red-400 text-sm mt-1'
                        }, errors.role)
                    )
                )
            );
        };

        // Edit User Modal Component
        const EditUserModal = ({ user, onClose, onSubmit }) => {
            const [formData, setFormData] = useState({
                email: user.email || '',
                password: '',
                status: user.status || 'approved'
            });
            const [errors, setErrors] = useState({});
            const [showPassword, setShowPassword] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);

            const validateEmail = (email) => {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            };

            const validatePassword = (password) => {
                if (!password) return { valid: true }; // Password is optional for edit
                if (password.length < 8) return { valid: false, message: 'Password must be at least 8 characters' };
                if (!/[A-Z]/.test(password)) return { valid: false, message: 'Password must contain an uppercase letter' };
                if (!/[a-z]/.test(password)) return { valid: false, message: 'Password must contain a lowercase letter' };
                if (!/[0-9]/.test(password)) return { valid: false, message: 'Password must contain a number' };
                if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) return { valid: false, message: 'Password must contain a special character' };
                return { valid: true };
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const newErrors = {};

                if (!formData.email) {
                    newErrors.email = 'Email is required';
                } else if (!validateEmail(formData.email)) {
                    newErrors.email = 'Invalid email format';
                }

                if (formData.password) {
                    const passwordValidation = validatePassword(formData.password);
                    if (!passwordValidation.valid) {
                        newErrors.password = passwordValidation.message;
                    }
                }

                if (Object.keys(newErrors).length > 0) {
                    setErrors(newErrors);
                    return;
                }

                setIsSubmitting(true);
                try {
                    await onSubmit(user.id, formData);
                } finally {
                    setIsSubmitting(false);
                }
            };

            return React.createElement(Modal, {
                title: `Edit User: ${user.email}`,
                onClose: onClose,
                footer: [
                    React.createElement('button', {
                        key: 'cancel',
                        onClick: onClose,
                        className: 'px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition-colors',
                        disabled: isSubmitting
                    }, 'Cancel'),
                    React.createElement('button', {
                        key: 'submit',
                        onClick: handleSubmit,
                        className: 'px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-lg transition-colors',
                        disabled: isSubmitting
                    }, isSubmitting ? 'Updating...' : 'Update User')
                ]
            },
                React.createElement('form', {
                    onSubmit: handleSubmit,
                    className: 'space-y-4'
                },
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block text-sm font-medium text-slate-300 mb-2'
                        }, 'Email *'),
                        React.createElement('input', {
                            type: 'email',
                            value: formData.email,
                            onChange: (e) => {
                                setFormData({ ...formData, email: e.target.value });
                                setErrors({ ...errors, email: '' });
                            },
                            className: `w-full px-4 py-2 bg-white/10 border ${errors.email ? 'border-red-500' : 'border-white/20'} rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500`,
                            required: true
                        }),
                        errors.email && React.createElement('p', {
                            className: 'text-red-400 text-sm mt-1'
                        }, errors.email)
                    ),
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block text-sm font-medium text-slate-300 mb-2'
                        }, 'Password (leave blank to keep current)'),
                        React.createElement('div', {
                            className: 'relative'
                        },
                            React.createElement('input', {
                                type: showPassword ? 'text' : 'password',
                                value: formData.password,
                                onChange: (e) => {
                                    setFormData({ ...formData, password: e.target.value });
                                    setErrors({ ...errors, password: '' });
                                },
                                className: `w-full px-4 py-2 bg-white/10 border ${errors.password ? 'border-red-500' : 'border-white/20'} rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500`,
                                placeholder: 'Enter new password or leave blank'
                            }),
                            React.createElement('button', {
                                type: 'button',
                                onClick: () => setShowPassword(!showPassword),
                                className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-white'
                            }, showPassword ? 'ðŸ‘ï¸' : 'ðŸ‘ï¸â€ðŸ—¨ï¸')
                        ),
                        errors.password && React.createElement('p', {
                            className: 'text-red-400 text-sm mt-1'
                        }, errors.password)
                    ),
                    React.createElement('div', null,
                        React.createElement('label', {
                            className: 'block text-sm font-medium text-slate-300 mb-2'
                        }, 'Status *'),
                        React.createElement('select', {
                            value: formData.status,
                            onChange: (e) => {
                                setFormData({ ...formData, status: e.target.value });
                            },
                            className: 'w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-sky-500'
                        },
                            React.createElement('option', { value: 'approved' }, 'approved'),
                            React.createElement('option', { value: 'pending' }, 'pending'),
                            React.createElement('option', { value: 'suspended' }, 'suspended')
                        )
                    )
                )
            );
        };

        // Delete Confirmation Modal Component
        const DeleteConfirmationModal = ({ user, onClose, onConfirm }) => {
            const [isDeleting, setIsDeleting] = useState(false);

            const handleConfirm = async () => {
                setIsDeleting(true);
                try {
                    await onConfirm(user.id);
                } finally {
                    setIsDeleting(false);
                }
            };

            return React.createElement(Modal, {
                title: 'Delete User',
                onClose: onClose,
                footer: [
                    React.createElement('button', {
                        key: 'cancel',
                        onClick: onClose,
                        className: 'px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg transition-colors',
                        disabled: isDeleting
                    }, 'Cancel'),
                    React.createElement('button', {
                        key: 'confirm',
                        onClick: handleConfirm,
                        className: 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors',
                        disabled: isDeleting
                    }, isDeleting ? 'Deleting...' : 'Confirm Delete')
                ]
            },
                React.createElement('div', { className: 'space-y-4' },
                    React.createElement('p', {
                        className: 'text-slate-300 text-lg'
                    }, `Are you sure you want to delete user:`),
                    React.createElement('p', {
                        className: 'text-white font-semibold text-xl'
                    }, user.email),
                    React.createElement('p', {
                        className: 'text-red-400 text-sm'
                    }, 'This action cannot be undone. The user will be permanently deleted.')
                )
            );
        };

        // Main App Component
        const App = () => {
            return React.createElement(UserManagementTable);
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>

</html>

